<Project DefaultTargets="Clean;Build;NuGet;WiX" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
	<PropertyGroup>
    <!-- Use Visual Studio Team Services build number if available (defaults to 0) -->
    <BuildNumber>0</BuildNumber>
    <BuildNumber Condition="$(BUILD_BUILDNUMBER) != ''">$(BUILD_BUILDNUMBER)</BuildNumber>
    <PreRelease>-beta</PreRelease>
	</PropertyGroup>
	<PropertyGroup>
    <NUSpecFile>package\NUnitTDNet.nuspec</NUSpecFile>
		<SolutionFile>src\NUnitTDNetAdapter.sln</SolutionFile>
    <Version>3.2.1</Version>
    <PackagesPath>$(MSBuildProjectDirectory)\src\packages</PackagesPath>
		<OutputPath>$(MSBuildProjectDirectory)\build</OutputPath>
		<Properties>Version=$(Version);BuildNumber=$(BuildNumber);PreRelease=$(PreRelease);PackagesPath=$(PackagesPath);OutputPath=$(OutputPath)</Properties>
	</PropertyGroup>
	
	<ItemGroup>
		<Wxs Include="package\NUnitTDNet.wxs" />
	</ItemGroup>
		
	<Target Name="Clean">
		<RemoveDir Directories="$(OutputPath)" />
		<MSBuild Projects="$(SolutionFile)" Targets="Clean" Properties="$(Properties)" />
	</Target>
	
	<Target Name="Build">
		<MSBuild Projects="$(SolutionFile)" Properties="$(Properties)" />
	</Target>

  <Target Name="NuGet">
    <Exec WorkingDirectory="." Command="nuget pack $(NUSpecFile) -BasePath . -OutputDirectory $(OutputPath) -Properties $(Properties)" />
  </Target>
  
  <Target Name="WiX">
		<Exec Command='candle "@(Wxs)" -out "$(OutputPath)\%(Wxs.Filename).wixobj" -dVersion=$(Version) -dBuildNumber=$(BuildNumber) -dPreRelease=$(PreRelease) -dPackagesPath=$(PackagesPath) -dOutputPath=$(OutputPath)' />
	</Target>
</Project>
